# 🔐 Security Policy

MoneyG Finance Appのセキュリティに関するポリシーと脆弱性報告の手順について説明します。ユーザーの金融データを保護することが私たちの最優先事項です。

## 📋 目次
- [サポートされているバージョン](#サポートされているバージョン)
- [セキュリティ機能](#セキュリティ機能)
- [脆弱性の報告](#脆弱性の報告)
- [セキュリティアップデート](#セキュリティアップデート)
- [データ保護](#データ保護)
- [セキュリティベストプラクティス](#セキュリティベストプラクティス)

## 🛡️ サポートされているバージョン

以下のバージョンに対してセキュリティアップデートを提供しています：

| バージョン | セキュリティサポート |
| --------- | ------------------ |
| 1.2.x     | ✅ サポート中       |
| 1.1.x     | ⚠️ 限定サポート      |
| 1.0.x     | ❌ サポート終了      |
| < 1.0     | ❌ サポート終了      |

### サポートポリシー
- **最新バージョン**: 完全なセキュリティサポート
- **1つ前のメジャーバージョン**: 重要なセキュリティ修正のみ
- **それ以前のバージョン**: サポート終了

## 🔒 セキュリティ機能

### データ暗号化
- **ローカルデータベース**: SQLite暗号化実装（デバイス内完結）
- **機密データ**: AES-256暗号化でローカル保存
- **ファイルシステム**: デバイス固有の暗号化キー使用
- **外部通信**: 必要時のみHTTPS通信（アップデート・フィードバック等）

### 認証・認可
- **生体認証**: 指紋・顔認証対応（ローカル認証）
- **PIN/パスワード**: デバイスローカルでの認証
- **セッション管理**: アプリレベルでの自動ロック機能
- **デバイスロック連携**: OS標準のセキュリティ機能活用

### データアクセス制御
- **最小権限の原則**: 必要最小限のデバイス権限のみ要求
- **完全ローカル**: データはデバイス内でのみ保存・処理
- **サンドボックス**: アプリ専用領域での厳格なデータ分離
- **外部アクセス遮断**: ネットワーク経由でのデータアクセス無し

### セキュリティ監査
- **定期監査**: 四半期ごとのセキュリティレビュー
- **依存関係チェック**: 自動脆弱性スキャン
- **コードレビュー**: すべてのセキュリティ関連変更

## 🚨 脆弱性の報告

### 報告方法

**🔴 重要**: セキュリティ上の問題を発見した場合は、**公開のIssueトラッカーではなく**、以下の方法で報告してください。

#### 1. プライベート報告 (推奨)
```
GitHub Security Advisories:
https://github.com/paraccoli/flutter_finance_app/security/advisories/new
```

#### 2. メール報告
```
Email: security@flutter-finance-app.example.com
Subject: [SECURITY] 脆弱性報告 - [簡潔な説明]
```

### 報告テンプレート

```markdown
## 🔐 脆弱性報告

### 📝 概要
脆弱性の簡潔な説明

### 🎯 脆弱性の詳細
- **種類**: [SQL Injection / XSS / データ漏洩 / その他]
- **影響度**: [Critical / High / Medium / Low]
- **影響範囲**: [全ユーザー / 特定条件のユーザー / 管理者のみ]

### 🔄 再現手順
1. XXXを実行
2. YYYを入力
3. 脆弱性が発生

### 💥 潜在的な影響
- データ漏洩の可能性
- システムへの不正アクセス
- その他のリスク

### 🛠️ 推奨する修正方法
可能であれば修正案を提示

### 📱 環境情報
- アプリバージョン: 1.2.2
- OS: Android 12 / iOS 15
- デバイス: [デバイス名]

### 📎 追加情報
スクリーンショット、ログ、POCコードなど
```

### 報告者への謝辞

セキュリティ脆弱性を報告していただいた方には：
- **謝辞**: READMEおよびリリースノートでの謝辞掲載
- **迅速対応**: 24時間以内の初回応答
- **進捗報告**: 修正プロセス全体の透明性

## ⚡ セキュリティアップデート

### 対応プロセス

1. **受信・確認** (24時間以内)
   - 脆弱性報告の受信確認
   - 初期影響度評価

2. **調査・評価** (72時間以内)
   - 詳細な技術調査
   - 影響範囲の特定
   - CVSSスコア算出

3. **修正開発** (影響度に応じて)
   - **Critical**: 24-48時間
   - **High**: 1週間以内
   - **Medium**: 2週間以内
   - **Low**: 次回リリース

4. **テスト・検証**
   - セキュリティテスト実施
   - 回帰テスト実行

5. **リリース・通知**
   - セキュリティパッチリリース
   - ユーザーへの通知
   - CVE発行（必要に応じて）

### 緊急対応プロセス

**Critical/High脆弱性**の場合：
- 🚨 **即座対応**: 専用チーム結成
- 📢 **事前通知**: 修正版リリース予告
- 🔄 **ホットフィックス**: 緊急パッチリリース
- 📝 **詳細報告**: 事後分析レポート公開

## ローカル保存セキュリティ

### アーキテクチャの利点
MoneyG Finance Appは**完全ローカル保存**アーキテクチャを採用しており、以下のセキュリティ利点があります：

#### ゼロトラストネットワーク
- **データ外部送信なし**: 金融データが一切インターネットに送信されない
- **エアギャップ効果**: ネットワーク経由の攻撃から完全に保護
- **プライベートバイデザイン**: 設計段階からプライバシーを最優先

#### デバイスネイティブセキュリティ
- **OS統合**: AndroidKeystore、iOS Keychain活用
- **ハードウェアセキュリティ**: TEE（Trusted Execution Environment）利用
- **セキュアエンクレーブ**: 暗号化キーのハードウェア保護

### ローカル脅威モデル

#### 想定される脅威
1. **物理デバイスアクセス**: デバイス紛失・盗難
2. **マルウェア**: 悪意のあるアプリからのアクセス試行
3. **OS脆弱性**: オペレーティングシステムの脆弱性悪用
4. **アプリ改ざん**: APK改ざんやリバースエンジニアリング

#### 対策実装
```dart
// デバイス固有暗号化キーの生成
class DeviceSecurityService {
  Future<String> generateDeviceKey() async {
    final deviceInfo = await DeviceInfoPlugin().androidInfo;
    final uniqueId = '${deviceInfo.id}_${deviceInfo.fingerprint}';
    return await _deriveKeyFromDevice(uniqueId);
  }
  
  // ハードウェアベースの暗号化
  Future<String> encryptWithHardware(String data) async {
    final keyAlias = 'finance_app_key_${await getDeviceId()}';
    return await AndroidKeystore.encrypt(data, keyAlias);
  }
}
```

## 🛡️ データ保護

### 個人情報保護
- **完全ローカル**: 個人データは一切外部送信しない
- **デバイス内処理**: すべての計算・分析をローカルで実行
- **匿名化**: 必要時も識別情報を除去してローカル処理
- **データ主権**: ユーザーが完全にデータを管理

### 金融データ保護
- **エアギャップ**: インターネット接続不要の完全独立動作
- **暗号化保存**: ローカルデータベースの強力な暗号化
- **アクセス制御**: デバイスレベルでの厳格な権限管理
- **監査ログ**: ローカルでのデータアクセス記録（外部送信なし）

### ローカル保存の利点
- **プライバシー最優先**: データがデバイスから外に出ない
- **ネットワーク攻撃耐性**: オフライン動作でネットワーク脅威を回避
- **データ主権**: ユーザーがデータを完全制御
- **規制準拠**: 厳格なデータ保護規制にも対応

### 準拠する規格・法令
- **PCI DSS**: 決済カード業界データセキュリティ基準
- **GDPR**: EU一般データ保護規則（適用時）
- **個人情報保護法**: 日本の個人情報保護関連法令

## 🔧 セキュリティベストプラクティス

### 開発者向け

#### コーディング規約
```dart
// ❌ 悪い例：平文でパスワード保存
final password = "user_password";
await storage.write(key: "password", value: password);

// ✅ 良い例：暗号化してパスワード保存
final encryptedPassword = await encryptionService.encrypt(password);
await secureStorage.write(key: "password", value: encryptedPassword);
```

#### 依存関係管理
- 定期的な依存関係アップデート
- 既知の脆弱性を持つパッケージの回避
- `dart pub audit` での脆弱性チェック

#### セキュアコーディング
```dart
// ❌ 悪い例：平文でローカル保存
final password = "user_password";
await storage.write(key: "password", value: password);

// ✅ 良い例：暗号化してローカル保存
final encryptedPassword = await encryptionService.encrypt(password);
await secureStorage.write(key: "password", value: encryptedPassword);

// ✅ ローカル専用：デバイス固有キーでの暗号化
final deviceKey = await platformService.getDeviceKey();
final encryptedData = await encryptionService.encryptWithDeviceKey(
  data: sensitiveData, 
  deviceKey: deviceKey
);
await localDatabase.save(encryptedData);
```

#### ローカルデータ保護
- **デバイス固有暗号化**: 端末固有キーによる暗号化
- **SQLite暗号化**: `sqlcipher`等によるデータベース暗号化
- **ファイル権限**: アプリ専用ディレクトリでの厳格な権限設定
- **メモリ保護**: 機密データの適切なメモリクリア

### ユーザー向け

#### アプリ利用時のセキュリティ
- **最新版の利用**: 常に最新バージョンにアップデート
- **強力なPIN**: 推測困難なPIN/パスワード設定
- **生体認証**: 利用可能な場合は生体認証を有効化
- **デバイスセキュリティ**: デバイスの画面ロック・暗号化を活用
- **物理的保護**: デバイスの紛失・盗難対策

#### ローカルデータバックアップ
- **手動エクスポート**: CSVエクスポート機能での定期バックアップ
- **暗号化バックアップ**: エクスポートファイルの暗号化保護
- **安全な保管**: バックアップファイルの安全な場所での保管
- **復元テスト**: バックアップからの復元可能性の定期確認
- **複数バックアップ**: 異なる場所での複数バックアップ保持

#### デバイス紛失時の対策
- **リモートワイプ**: OS標準のリモートデータ削除機能活用
- **暗号化の効果**: デバイス暗号化による第三者アクセス防止
- **生体認証**: 物理アクセスでも認証が必要
- **自動ロック**: 一定時間後の自動ロック機能

## 📊 セキュリティメトリクス

### 公開指標
- **脆弱性対応時間**: 平均72時間
- **セキュリティアップデート頻度**: 月次
- **侵害報告**: 過去0件

### 監視項目
- **ローカル異常検知**: 不正なファイルアクセスパターン
- **認証失敗監視**: 連続した認証失敗の検出
- **データ整合性**: ローカルデータベースの整合性チェック
- **アプリ改ざん検知**: バイナリファイルの整合性確認
- **デバイス状態**: ルート化・脱獄デバイスの検出

## 🆘 インシデント対応

### インシデント分類
- **P0 - Critical**: データ漏洩、システム侵害
- **P1 - High**: 重要機能の停止、セキュリティ機能の無効化
- **P2 - Medium**: 限定的な機能影響
- **P3 - Low**: 軽微なセキュリティ問題

## 📞 連絡先
- **Email**: contact@paraccoli.com

### 報告の確認
すべてのセキュリティ報告には24時間以内に確認メールを送信します。確認メールが届かない場合は、再度ご連絡ください。

---

*最終更新: 2025年6月10日*  
*次回見直し予定: 2025年9月10日*
